unbind C-b

set -g prefix C-a
bind C-a send-prefix

# ┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈     setup     ┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈

set -g mouse on
set -g base-index 1
set -g pane-base-index 1
set -g allow-rename on
set -g renumber-windows on
setw -g mode-keys vi
set -sg escape-time 0
setw -g aggressive-resize on

# ┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈     alacritty     ┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈

set -g default-terminal "tmux-256color" # https://gist.github.com/bbqtd/a4ac060d6f6b9ea6fe3aabe735aa9d95
set -ga terminal-overrides ',*:RGB'
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'  # undercurl support
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'

set-option -g visual-activity off
set-option -g visual-bell off
set-option -g visual-silence off
set-option -g bell-action none
set-option -g remain-on-exit on
set-option -g default-shell "/opt/homebrew/bin/fish"
set-window-option -g monitor-activity off
set-window-option -g mode-keys vi

# ┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈     colors     ┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈

dark_theme=0
fg1="#{?dark_theme,#a3b8ef,#aaaaaa}"
fg2="#{?dark_theme,#c2a2e3,#444444}"

sep="•"
s1="#[fg=${fg1}]"
s2="#[fg=${fg2}]"
date="%Y-%m-%d"
time="%H:%M"
process="#{s|.+NVIM$||;s|.+fish$||:pane_title}"
path="#(echo #{pane_current_path} | sed -E 's/ilyapu|kaiphat/~/' | rev | cut -d'/' -f-2 | rev)"

# ┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈     status line     ┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈

set -g status-left ""
set -g status-right "${s1}${process} ${sep} ${date} ${time}"
set -g window-status-format "${s1}${path} ${sep} "
set -g window-status-current-format "${s2}${path} ${s1}${sep} "
set -g window-status-separator ""
set -g mode-style "fg=${fg1},bg=default"
set -g message-style "fg=${fg1},bg=default"
set -g message-command-style "fg=${fg1},bg=default"
set -g pane-border-style fg=#99aee5
set -g pane-active-border-style fg=#99aee5

set -g status-interval 10
set -g status-position top
set -g status-bg default
set -g status-style default
set -g status-justify left
set -g status-left-length 100
set -g status-right-length 200

# ┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈     bindings     ┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈

bind r source-file ~/.tmux.conf \; display ".tmux.conf reloaded"

bind -r h resize-pane -L 4
bind -r j resize-pane -D 2
bind -r k resize-pane -U 2
bind -r l resize-pane -R 4

bind / copy-mode \; send-key ?
bind [ select-layout tiled
bind C-u copy-mode
bind -n M-v copy-mode
bind C-z copy-mode
bind D detach

bind x kill-window -a
bind q kill-pane -a
# popup -E run fish process in current directory
bind o popup -E "fish -c 'cd ~/work'"

bind C-m splitw -b -h -l 27% -c "#{pane_current_path}"
# 4 panes
bind C-l splitw -l 50% -c "#{pane_current_path}" -h \;\
         select-pane -t 1 \;\
         splitw -l 50% -c "#{pane_current_path}" \;\
         select-pane -t 1 \;\
         splitw -l 50% -c "#{pane_current_path}" -h \;\
         select-pane -t 1 \;\
         select-layout tiled
# 6 panes
bind C-k splitw -l 50% -c "#{pane_current_path}" -h \;\
         select-pane -t 1 \;\
         splitw -l 50% -c "#{pane_current_path}" \;\
         select-pane -t 1 \;\
         splitw -l 50% -c "#{pane_current_path}" -h \;\
         select-pane -t 1 \;\
         splitw -l 50% -c "#{pane_current_path}" \;\
         select-pane -t 1 \;\
         splitw -l 50% -c "#{pane_current_path}" -h \;\
         select-pane -t 1 \;\
         select-layout tiled

bind C-j splitw -p 32 -c "#{pane_current_path}" -b -h \;\
         splitw -l 50% -c "#{pane_current_path}" \;\
         select-pane -t 1 \;\
         splitw -l 50% -c "#{pane_current_path}" \;\
         select-pane -t 3 \;\
         splitw -l 50% -c "#{pane_current_path}" \;\
         select-pane -t 5 \;\
         splitw -l 50% -c "#{pane_current_path}" \;\
         select-pane -t 1 \;\
         select-pane -t 5

bind C-i splitw -p 32 -c "#{pane_current_path}" -b -h \;\
         select-pane -t 1 \;\
         splitw -l 50% -c "#{pane_current_path}" \;\
         select-pane -t 2 \;\
         splitw -l 50% -c "#{pane_current_path}" \;\
         select-pane -t 1 \;\
         splitw -l 50% -c "#{pane_current_path}" \;\
         select-pane -t 1 \;\
         select-pane -t 5

bind -n M-n previous-window
bind -n M-p next-window
bind -n M-z resize-pane -Z
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

bind -n M-i new-window -c "#{pane_current_path}" -n 1
bind -n M-o splitw -h -c "#{pane_current_path}"
bind -n "M-'" splitw -v -c "#{pane_current_path}"

bind -n M-X kill-window
bind -n M-q kill-pane
# bind -n M-q run-shell ~/dotfiles/scripts/tmux_close.sh

bind -n -r M-s swap-pane -D

bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# ┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈     plugins     ┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈┈

set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-sessionist'
set -g @plugin 'laktak/extrakto'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tpm'

set -g @continuum-boot 'on'
set -g @continuum-restore 'on'
set -g @continuum-save-interval '1' # minutes

set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-capture-pane-contents 'off'

set -g @yank_action 'copy-pipe'

set -g @extrakto_popup_position "B"
set -g @extrakto_split_direction "v"
set -g @extrakto_copy_key "tab"
set -g @extrakto_insert_key "enter"
set -g @extrakto_split_size	"15"

run '~/.tmux/plugins/tpm/tpm'
